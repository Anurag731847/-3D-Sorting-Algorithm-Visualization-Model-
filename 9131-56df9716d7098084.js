try{let e="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:{},t=(new e.Error).stack;t&&(e._sentryDebugIds=e._sentryDebugIds||{},e._sentryDebugIds[t]="af0c1651-5401-4521-a887-3e78e39c157a",e._sentryDebugIdIdentifier="sentry-dbid-af0c1651-5401-4521-a887-3e78e39c157a")}catch(e){}"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[9131],{25057:function(e,t,r){r.d(t,{t:function(){return s},u:function(){return n}});let n=()=>localStorage.API_BASE_URL?localStorage.API_BASE_URL:"https://api.lovable.dev",s=()=>"https://lovable-api.com"},64040:function(e,t,r){r.d(t,{B8:function(){return u},Eo:function(){return h},SC:function(){return l}});var n=r(14438),s=r(31229),a=r(21288),o=r(75502),i=r(65001),c=r(85472);let l={network:"network_error",malformed:"malformed_response"},d=s.z.object({type:s.z.string(),message:s.z.string().optional().transform(e=>e||void 0),details:s.z.string().optional().transform(e=>e||void 0)});function u(e){if((0,o.kW)(e)){var t;let r={url:null===(t=e.response)||void 0===t?void 0:t.url,method:e.httpMethod,status:e.status};if(!e.response)return(0,i.H)("Network error",{error:e,severity:a.in.INFO,context:r}),new c.H(l.network,"Connection Error","Please check your internet connection");let n=e.data,s=d.safeParse(n);if(s.success){let t=new c.H(s.data.type,s.data.message||"",s.data.details,e.status);return(0,i.v)({error:t,severity:a.in.INFO,context:r}),t}return(0,i.H)("Bad error from backend",{error:e,severity:a.in.ERROR,context:{...r,error_data:n,response:e.response,zodError:s.error}}),new c.H(l.malformed,e.statusText||"",void 0,e.status)}return(0,i.H)("Unhandled error type",{error:e,severity:a.in.ERROR}),new c.H(l.malformed,"")}function h(e){e instanceof c.H?(n.Am.error(e.message||"Something went wrong",e.details?{description:e.details}:void 0),e.message||(0,i.H)("User sees vague api error",{error:e,severity:a.in.ERROR})):(n.Am.error("Something went wrong",{description:"Lovable has been notified."}),(0,i.H)("User sees vague error",{error:e,severity:a.in.ERROR}))}},75502:function(e,t,r){function n(e){return e instanceof Error&&"number"==typeof e.status&&"data"in e&&"string"==typeof e.httpMethod}r.d(t,{B:function(){return a},kW:function(){return n}});class s{setResponseHandler(e){this.responseHandler=e}setErrorHandler(e){this.errorHandler=e}createUrl(e,t){let r=new URL("".concat(this.baseURL).concat(e));return t&&Object.entries(t).forEach(e=>{let[t,n]=e;null!=n&&r.searchParams.append(t,n)}),r.toString()}createRequestOptions(e,t,r){let n={method:e,headers:{"Content-Type":"application/json",...this.defaultHeaders,...(null==t?void 0:t.headers)||{}},credentials:this.withCredentials?"include":"same-origin",signal:null==t?void 0:t.signal};return void 0===r||["GET","HEAD"].includes(e)||(n.body=JSON.stringify(r)),n}async processResponse(e){return this.responseHandler?await this.responseHandler(e):e}async processError(e){throw this.errorHandler&&(e=await this.errorHandler(e)),e}async request(e,t,r,n){try{let s=this.createUrl(t,null==r?void 0:r.params),a=this.createRequestOptions(e,r,n),o=await fetch(s,a);if(!o.ok){let t=Error("Request failed with status ".concat(o.status));t.response=o,t.status=o.status,t.statusText=o.statusText,t.httpMethod=e;let r=o.clone();try{t.data=await r.json()}catch(e){t.data=await o.text()}return this.processError(t)}if(204===o.status||"0"===o.headers.get("Content-Length"))return this.processResponse({});let i=await o.json();return this.processResponse(i)}catch(e){return this.processError(e)}}async get(e,t){return this.request("GET",e,t)}async delete(e,t){return this.request("DELETE",e,t)}async head(e,t){return this.request("HEAD",e,t)}async post(e,t,r){return this.request("POST",e,r,t)}async put(e,t,r){return this.request("PUT",e,r,t)}async patch(e,t,r){return this.request("PATCH",e,r,t)}constructor(e,t={},r=!1){this.responseHandler=null,this.errorHandler=null,this.baseURL=e,this.defaultHeaders=t,this.withCredentials=r}}function a(e){return new s(e.baseURL,e.headers,e.withCredentials)}},49131:function(e,t,r){r.d(t,{S:function(){return _}});var n=r(31229),s=r(52285),a=r(66454),o=r(21288);async function*i(e){yield*c(l(e))}async function*c(e){let t=null;for await(let r of e)if(!r.startsWith(":")){if(r.startsWith("event:")){t&&o.PW.error("received_sse_event_without_data",{event_type:t}),t=r.slice(6).trim();continue}if(r.startsWith("data:")){let e=r.slice(5).trimStart();try{yield{type:t,data:JSON.parse(e)}}catch(r){o.PW.error("failed_to_parse_sse_event",{error:r,event_type:t,event_data:e})}t=null}}}async function*l(e){let t=new TextDecoder,r="";for(;;){let{done:n,value:s}=await e.read(),a=(r+=t.decode(s,{stream:!n})).split(/\n+/);for(let e of(r=a.pop()||"",a))yield e;if(n){r&&(yield r);break}}}var d=r(85472),u=r(64040),h=r(75502),p=r(65001),f=r(35034);class y{async getApi(){var e;if(!a.g.isInitialized())return await new Promise(e=>setTimeout(e,50)),this.getApi();let t=await a.g.getValidToken();t||(0,p.H)("Tried to get API with no valid ID token",{error:Error("Tried to get API with no valid ID token"),severity:o.in.ERROR});let r=(e=this.baseURL,(0,h.B)({baseURL:e,headers:t?{Authorization:"Bearer ".concat(t)}:void 0,withCredentials:!0}));return r.setResponseHandler(e=>e),r.setErrorHandler(e=>{if(e&&"object"==typeof e&&"status"in e&&401===e.status){let e=window.location.pathname;s.i.emitAuthError(e)}return Promise.reject((0,u.B8)(e))}),r}async get(e,t){return(await this.getApi()).get(e,t)}async delete(e,t){return(await this.getApi()).delete(e,t)}async post(e,t,r){return(await this.getApi()).post(e,t,r)}async put(e,t,r){return(await this.getApi()).put(e,t,r)}async patch(e,t,r){return(await this.getApi()).patch(e,t,r)}async head(e,t){return(await this.getApi()).head(e,t)}async postWithStreaming(e,t,r,n){let s=await a.g.getValidToken(),c=await fetch("".concat(this.baseURL).concat(e),{method:"POST",headers:{"Content-Type":"application/json",...s?{Authorization:"Bearer ".concat(s)}:{},Accept:"text/event-stream",Connection:"keep-alive","Cache-Control":"no-cache"},body:JSON.stringify(t),signal:n});if(!c.ok){let e;try{let t=await c.text(),r=c.headers.get("Content-Type")||"";if(r.includes("application/json"))try{e=JSON.parse(t)}catch(n){o.PW.error("failed_to_parse_json_response",{error:n,responseText:t,contentType:r}),e=t}else o.PW.debug("non_json_error_response",{contentType:r,responseText:t}),e=t}catch(e){o.PW.error("failed_to_parse_response_body",{error:e,status:c.status,contentType:c.headers.get("Content-Type")})}if(429===c.status)throw new f.O("We are currently under heavy load, please try again later.",429,"RATE_LIMIT_EXCEEDED",e);throw new f.O("Request failed",c.status,c.statusText,e)}let l=c.body.getReader();try{for await(let e of i(l)){if("error"===e.type)throw function(e){let t=w.safeParse(e.data);return t.success?(o.PW.error("server_sse_error",{error:t.data}),new f.O(t.data.message,500,t.data.type,t.data)):(o.PW.error("failed_to_parse_server_sse_error",{parse_error:t.error,event_data:e.data}),new d.H(u.SC.malformed,"",void 0,500))}(e);try{r(e)}catch(e){o.PW.error("unhandled_error_in_message_handler",{error:e})}}}catch(e){if(await l.cancel().catch(()=>{}),e instanceof Error&&"AbortError"===e.name)return;if(e instanceof f.O)throw e;throw o.PW.error("unexpected_error_during_sse",{error:e}),e}finally{l.releaseLock()}}constructor(e){this.baseURL=e}}let w=n.z.object({type:n.z.string(),message:n.z.string(),details:n.z.string()}),g=new y((0,r(25057).t)());function _(){return g}},65001:function(e,t,r){r.d(t,{H:function(){return i},v:function(){return o}});var n=r(22048),s=r(21288);let a={[s.in.ERROR]:"error",[s.in.WARN]:"warn",[s.in.INFO]:"info",[s.in.DEBUG]:"debug",[s.in.TRACE]:"trace",[s.in.LOG]:"log"};function o(e){let{error:t,severity:r,context:o}=e,i={...o,errorType:t.type},c=a[r];s.PW[c]("api_error_".concat(t.type),{error:t,...i}),(r===s.in.ERROR||r===s.in.WARN)&&n.Tb(Error("API Error: ".concat(t.type)),{extra:{...t,...i}})}function i(e,t){let{error:r,severity:o,context:i}=t,c="".concat(e,": ").concat(r instanceof Error?r.message:"Weird error"),l=r instanceof Error?r:Error(c),d=a[o];s.PW[d](c,{...i,error:r}),(o===s.in.ERROR||o===s.in.WARN)&&(l.message=c,n.Tb(l,{level:o===s.in.ERROR?"error":"warning",extra:{...i,weird_error:r instanceof Error?void 0:r}}))}},52285:function(e,t,r){r.d(t,{i:function(){return a}});var n=r(55445);class s extends n.EventEmitter{emitAuthError(e){this.emit("auth:error",{pathname:e})}}let a=new s}}]);