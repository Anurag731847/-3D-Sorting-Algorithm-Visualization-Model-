try{let e="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:{},t=(new e.Error).stack;t&&(e._sentryDebugIds=e._sentryDebugIds||{},e._sentryDebugIds[t]="0bce7052-169c-48d8-91f5-38f09b8aac2b",e._sentryDebugIdIdentifier="sentry-dbid-0bce7052-169c-48d8-91f5-38f09b8aac2b")}catch(e){}"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[2558],{52558:function(e,t,n){n.d(t,{E:function(){return h},H:function(){return g}});var r=n(57437),s=n(99376),i=n(2265),o=n(28667),a=n(66454),c=n(78099),u=n(21288);let l=()=>{let[e,t,n]=(0,o.F_)(c.I);return[e,t,n]},d=(0,i.createContext)(void 0),f=null,h=()=>{let e=(0,i.useContext)(d);if(!e)throw Error("useAuthContext must be used within an AuthProvider");return e},g=e=>{let{user:t,children:n}=e,[h,g]=(0,i.useState)(!1),[p]=l(),[v,m,I]=(0,o.QJ)(c.I),k=(0,s.useRouter)();return(0,i.useEffect)(()=>{t&&t.idToken&&a.g.setServerIdToken(t.idToken)},[t]),(0,i.useEffect)(()=>((async function(){if(!t){g(!1),f&&(clearInterval(f),f=null);return}await (0,c.j)(t.customToken,!0),g(!0),f||(f=setInterval(async()=>{let e=c.I.currentUser;if(!e){await (0,c.j)(t.customToken,!0);return}try{await e.getIdToken(!0)}catch(e){var n;u.PW.error("AuthProvider: Failed to refresh Firebase token",{error:e,userId:null===c.I||void 0===c.I?void 0:null===(n=c.I.currentUser)||void 0===n?void 0:n.uid})}k.replace("?should-refresh-credentials=1"),k.refresh()},18e5))})(),()=>{!t&&f&&(clearInterval(f),f=null)}),[t,k]),(0,i.useEffect)(()=>{!t&&p&&(u.PW.info("Setting user cookie based on IndexDB and deleting IndexDB"),p.getIdToken().then(async e=>{try{if((await fetch("/api/login",{method:"GET",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(e)}})).ok){k.replace("?should-refresh-credentials=1"),u.PW.info("Successfully set auth cookies");let e=new URLSearchParams(window.location.search).get("redirect");e&&k.push(e),k.refresh()}else u.PW.info("Failed to set auth cookies. Did not remove IndexedDB.")}catch(e){u.PW.warn("Unknown error when trying to set auth cookies. Did not remove IndexedDB.",{error:e})}}))},[p,k,v,t]),(0,r.jsx)(d.Provider,{value:{authUser:t,isInitialized:h},children:n})}},85472:function(e,t,n){n.d(t,{H:function(){return r}});class r extends Error{constructor(e,t,n,r){super(t),this.type=e,this.details=n,this.status=r}}},35034:function(e,t,n){n.d(t,{O:function(){return r}});class r extends Error{constructor(e,t,n,r){super(e),this.status=t,this.statusText=n,this.response=r}}},66454:function(e,t,n){n.d(t,{g:function(){return i}});var r=n(27277);class s{setServerIdToken(e){this.serverIdToken=e,this.initialized=!0}isInitialized(){return this.initialized}async getValidToken(){if(!this.serverIdToken)return null;if(this.refreshPromise)return this.refreshPromise;try{this.refreshPromise=(0,r.B)({serverIdToken:this.serverIdToken,refreshTokenUrl:"/api/refresh-token"});let e=await this.refreshPromise;return this.refreshPromise=null,e}catch(e){return this.refreshPromise=null,null}}constructor(){this.serverIdToken=null,this.refreshPromise=null,this.initialized=!1}}let i=new s},54257:function(e,t,n){n.d(t,{q:function(){return r}});let r="production"===(n(25566).env.NEXT_PUBLIC_NODE_ENV||"production")?{apiKey:"AIzaSyBQNjlw9Vp4tP4VVeANzyPJnqbG2wLbYPw",authDomain:"auth.gptengineer.app",projectId:"gpt-engineer-390607",storageBucket:"gpt-engineer-390607.appspot.com",messagingSenderId:"288002387414",appId:"1:288002387414:web:231da37c38c486ca814877",measurementId:"G-EFZ8TB5QLN",clientEmail:"firebase-adminsdk-thfj5@gpt-engineer-390607.iam.gserviceaccount.com"}:{apiKey:"AIzaSyC8MAnZTLUBttWHlEIMl0u8gGI0R5oGnXU",authDomain:"gpt-engineer-dev.firebaseapp.com",projectId:"gpt-engineer-dev",storageBucket:"gpt-engineer-dev.appspot.com",messagingSenderId:"435422046193",appId:"1:435422046193:web:36e2c4049799e14110c650",clientEmail:"firebase-adminsdk-tg5bc@gpt-engineer-dev.iam.gserviceaccount.com"}},78099:function(e,t,n){n.d(t,{I:function(){return l},db:function(){return u},j:function(){return f}});var r=n(44752),s=n(46886),i=n(21288),o=n(738),a=n(5978),c=n(54257);let{db:u,auth:l}=(()=>{let e=(0,o.ZF)(c.q),t=(0,a.LV)(e,{experimentalForceLongPolling:!0}),n=(0,r.v0)(e);return{app:e,db:t,auth:n}})(),d=!1,f=async function(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(!d&&t&&e){d=!0;let t=await (0,s.Q9)({serverCustomToken:e,refreshTokenUrl:"/api/refresh-token"});if(!t)return d=!1,i.PW.error("No custom token found in initialize()"),{db:u,auth:l};try{await (0,r._p)(l,t)}catch(e){i.PW.error("Unable to sign-in with custom-token in firebase initialization: ".concat(e)),d=!1}}return{db:u,auth:l}}},21288:function(e,t,n){n.d(t,{GR:function(){return f},PW:function(){return p},in:function(){return s}});var r,s,i=n(49360),o=n(59625),a=n(35034),c=n(85472),u=n(25566);(r=s||(s={})).LOG="LOG",r.TRACE="TRACE",r.DEBUG="DEBUG",r.INFO="INFO",r.WARN="WARN",r.ERROR="ERROR";class l{static generateSessionId(){return(0,i.Z)()}setSession(e){this._session={session_id:l.generateSessionId(),previous_session:this._session.session_id,project_id:e}}setUser(e){this._user=e}get session(){return this._session}get user(){return this._user}sessionForLogging(){let{session_id:e,...t}=this._session;return{session_id:e,...Object.fromEntries(Object.entries(t).filter(e=>{let[t,n]=e;return void 0!==n}).map(e=>{let[t,n]=e;return["session_attrs_".concat(t),n]}))}}userForLogging(){return Object.fromEntries(Object.entries(this._user||{}).filter(e=>{let[t,n]=e;return void 0!==n}).map(e=>{let[t,n]=e;return["user_".concat(t),n]}))}getForLogging(){return Object.fromEntries(Object.entries({...this.sessionForLogging(),...this.userForLogging()}).filter(e=>{let[t,n]=e;return void 0!==n}))}constructor(){this._session={session_id:l.generateSessionId()}}}let d=new l,f=(0,o.Ue)(e=>({metadata:d,setMetadata:t=>e({metadata:t})})),h=async(e,t)=>{var n;let r=t[0],s=null!==(n=t[1])&&void 0!==n?n:{},i=(1e9*Math.floor(Date.now()/1e3)).toString(),o=Object.entries({msg:r,...s,...d.getForLogging(),level:e}).map(e=>{let[t,n]=e;return"".concat(t,"=").concat(JSON.stringify(n,function e(t,n){return n instanceof a.O?{error_class:"StreamedFetchError",message:n.message,status:n.status,statusText:n.statusText,response:e("response",n.response),stack:n.stack}:n instanceof c.H?{error_class:"ApiError",type:n.type,message:n.message,details:n.details,status:n.status,stack:n.stack}:n instanceof Error?{error_class:n.constructor.name,message:n.message,stack:n.stack}:n}))}).join(" "),l={streams:[{stream:{service_name:"gptengineer-app",name:"gptengineer-app",version:u.env.NEXT_PUBLIC_VERSION||"1.0.0",environment:"production",commit_sha:"74f7524ac27fa81841b2739a07b80f96cee0fe8d",level:e},values:[[i,o]]}]},f="https://us-central1-gpt-engineer-390607.cloudfunctions.net/pushLogsToGrafana";if(f)try{await fetch(f,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(l)})}catch(e){}},g=(e,t)=>{h(e,t)},p={info:function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];g("INFO",t)},debug:function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];g("DEBUG",t)},trace:function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];g("TRACE",t)},warn:function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];g("WARN",t)},error:function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];g("ERROR",t)},log:function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];g("LOG",t)}}},27277:function(e,t,n){n.d(t,{B:function(){return a}});var r=n(88132),s=n(71856);class i{get(e){return this.cacheMap[e]?this.cacheMap[e]:e}set(e,t){this.cacheMap={[e]:t}}constructor(){this.cacheMap={}}}let o=new i;async function a(e){var t;let{serverIdToken:n,refreshTokenUrl:i,checkRevoked:a}=e;if(!n)return null;let c=o.get(n),u=(0,r.t)(c),d=null!==(t=null==u?void 0:u.exp)&&void 0!==t?t:0,f=Date.now()/1e3;if(!a&&f+300<d)return c;let h=await l(i);if(!(null==h?void 0:h.idToken))throw new s.AuthError(s.AuthErrorCode.INTERNAL_ERROR,"Refresh token endpoint returned invalid response. This URL should point to endpoint exposed by the middleware and configured using refreshTokenPath option");return o.set(n,h.idToken),h.idToken}async function c(e,t,n){var r;let i=await u(e);return new s.AuthError(s.AuthErrorCode.INTERNAL_ERROR,"next-firebase-auth-edge: Internal request to ".concat(null!==(r=null==n?void 0:n.method)&&void 0!==r?r:"GET"," ").concat(t.toString()," has failed: ").concat(i))}function u(e){let t=e.headers.get("content-type");return t&&-1!==t.indexOf("application/json")?e.json():e.text()}async function l(e,t){let n=await fetch(e,{...t,headers:{...null==t?void 0:t.headers,Accept:"application/json","Content-Type":"application/json"}});if(!n.ok)throw await c(n,e,t);return u(n)}}}]);